<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index</title>
    <script src="static/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.7/handlebars.min.js"></script>
    <link rel="stylesheet" href="static/css/styles.css">
</head>
<body>

    <script id="categories-template" type="text/x-handlebars-template">
        <ul>
        {{#each categories}}
            <li>
            <div class="category">
                <h2> <a href="category?id={{id}}"> {{title}} </a></h2>
                <img src="https://wiki-ads.onrender.com/{{img_url}}">
                <ul>
                {{#each subcategories}}
                    <li><a href="subcategory?id={{id}}">{{title}}</a></li>
                {{/each}}
                </ul>
            </div>
            </li>
        {{/each}}
        </ul>
    </script>
    <script>

        Promise.all([getCategories(), getSubCategories()])
        .then(([categories, subcategories]) => {
            let categoryMap = createCategorymap(categories, subcategories);

            // handlebars
            let templateSource = document.getElementById("categories-template").innerHTML;
            let template = Handlebars.compile(templateSource);
            let data = {
                categories: categories.map(category => ({
                    id: category.id,
                    title: category.title,
                    img_url: category.img_url,
                    subcategories: subcategories.filter(subcategory => subcategory.category_id === category.id)
                }))
            };
            let html = template(data);
            document.body.innerHTML += html;
        });
      </script>


    
</body>
</html>